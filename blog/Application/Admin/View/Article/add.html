<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link href="__PUBLIC__/Admin/assets/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="__PUBLIC__/Admin/css/style.css"/>
<link href="__PUBLIC__/Admin/assets/css/codemirror.css" rel="stylesheet">
<link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace.min.css" />
<link rel="stylesheet" href="__PUBLIC__/Admin/font/css/font-awesome.min.css" />
<!--[if lte IE 8]>
  <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-ie.min.css" />
<![endif]-->
<script src="__PUBLIC__/Admin/js/jquery-1.9.1.min.js"></script>
<script src="__PUBLIC__/Admin/assets/js/bootstrap.min.js"></script>
<script src="__PUBLIC__/Admin/assets/js/typeahead-bs2.min.js"></script>
<script src="__PUBLIC__/Admin/assets/js/jquery.dataTables.min.js"></script>
<script src="__PUBLIC__/Admin/assets/js/jquery.dataTables.bootstrap.js"></script>
<script src="__PUBLIC__/Admin/assets/layer/layer.js" type="text/javascript" ></script>
<script src="__PUBLIC__/Admin/assets/laydate/laydate.js" type="text/javascript"></script>
<script src="__PUBLIC__/Admin/js/dragDivResize.js" type="text/javascript"></script>

<script type="text/javascript">
window.UEDITOR_HOME_URL = '__PUBLIC__/Admin/Widget/Data/';
window.onload = function(){
    window.UEDITOR_CONFIG.toolbars= [[

        'bold', 'italic', 'underline', '|', 'forecolor', 'backcolor',  '|', 'fontfamily', 'fontsize', '|',

        'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|','insertimage','link','removeformat'

    ]];
    UE.getEditor('editor');
}
</script>
<script type="text/javascript" src="__PUBLIC__/Admin/Widget/Data/ueditor.config.js"></script>
<script type="text/javascript" src="__PUBLIC__/Admin/Widget/Data/ueditor.all.min.js"> </script>
    <script src="__PUBLIC__/Admin/color/iColorPicker.js" type="text/javascript"></script>
    <link rel="stylesheet" href="__PUBLIC__/Index/css/bootstrap.min.css">

    <script src="__PUBLIC__/Index/js/bootstrap.min.js"></script>
<title>添加文章</title>
</head>
<body>
<div class="Competence_add_style clearfix">
    <div class="left_Competence_add"  style="width:30%;">
        <div class="title_name">选择标签</div>

        <dl class="permission-list">
            <dt>
            <ul  class="list-inline" style="display:block;line-height:30px;" id="tag_list">
                <?php foreach($tagData as $k => $v): ?>
                <li style="display:inline;line-height:30px;"><label class="middle"><input type="checkbox" name="article_tag_id_list[]" value="<?php echo $v['id']; ?>" class="ace"><span class="lbl"><span class="label" style="border-radius:.25em;background:<?php echo $v['tag_background_color']?>;" ><?php echo $v['tag_name']; ?></span></span></label></li>
                <?php endforeach; ?>
            </ul>
            </dt>
        </dl>


        <div class="title_name">添加新标签</div>
        <form id="form2" method="post">
            <br />
            <div class="form-group"><label class="col-sm-3 control-label no-padding-right"> 标签名称 </label>
                <div class="col-sm-9"><input type="text" name="tag_name" class="col-xs-10 col-sm-5"></div>
            </div>

            <div class="form-group"><label class="col-sm-3 control-label no-padding-right"> 背景颜色 </label>
                <div class="col-sm-9"><input id="mycolor" name="tag_background_color" class="iColorPicker bg" type="text" value="#ff0" disabled/></div>
            </div>

            <div class="form-group"><label class="col-sm-3 control-label no-padding-right"> 外观 </label>
                <div class="col-sm-9">&nbsp;&nbsp;&nbsp;<label class="label_name"><span class="label" id="tag"></span></label></div>
            </div>

            <div class="Button_operation">
                <input class="btn btn-primary radius" type="button" id="submit1" value="&nbsp;&nbsp;添加&nbsp;&nbsp;">
            </div>


        </form>
    </div>
    <div class="left_Competence_add"  style="width:70%;">
        <div class="title_name">添加文章</div>
        <div class="Competence_add">
        <form id="form1" method="post">
            <div class="form-group"><label class="col-sm-2 control-label no-padding-right"> 文章标题 </label>
                <div class="col-sm-9"><input type="text" name="ar_title" class="col-xs-10 col-sm-5"></div>
            </div>

            <div class="form-group"><label class="col-sm-2 control-label no-padding-right"> 文章作者 </label>
                <div class="col-sm-9"><input type="text" name="ar_author" class="col-xs-10 col-sm-5"></div>
            </div>

            <div class="form-group"><label class="col-sm-2 control-label no-padding-right"> 文章分类 </label>
                <div class="col-sm-3">
                    <select class="col-xs-12" style="margin-left:10px;" name="ar_category_id">
                        <option value="0">请选择文章分类</option>
                        <?php foreach($catData as $k => $v): ?>
                            <option value="<?php echo $v['id']; ?>"><?php echo $v['cat_name']; ?></option>
                        <?php endforeach; ?>
                    </select>
                </div>
            </div>

            <div class="form-group"><label class="col-sm-2 control-label no-padding-right"> 状态 </label>
                <div class="col-sm-9">&nbsp;
                    <label><input name="ar_show_status" type="radio" class="ace" checked="checked" value="启用"><span class="lbl">启用</span></label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <label><input type="radio" class="ace" name="ar_show_status" value="停用"><span class="lbl">停用</span></label>
                </div>
            </div>

            <div class="form-group"><label class="col-sm-2 control-label no-padding-right" > 文章内容 </label>
                 <div class="col-sm-9"><textarea name="ar_content" id="editor" style="height:300px;margin-left:10px;"></textarea></div>
            </div>

        </div>
   <!--按钮操作-->
       <div class="Button_operation">
            <button class="btn btn-primary radius" id="submit"><i class="fa fa-save "></i> 保存并提交</button>
            <button class="btn btn-default radius" type="reset">&nbsp;&nbsp;重置&nbsp;&nbsp;</button>
       </div>
        </form>
   </div>






</div>


</body>
</html>
<script>

    /*************添加文章***********/
    $('#submit').click(function(){

        var ar_title = $('input[name=ar_title]').val();
        var ar_author = $('input[name=ar_author]').val();
        var ar_category_id = $('select').val();
        var ar_content = $('textarea').val();

        var checkedNum = $("input[type=checkbox]:checked").length;


        if(ar_title.trim() == ""){
            layer.alert("文章标题不能为空",{
                title: '提示框',
                icon:2,
            });
            return false;
        }

        if(ar_author.trim() == ""){
            layer.alert("文章作者不能为空",{
                title: '提示框',
                icon:2,
            });
            return false;
        }
        if(ar_content.trim() == ""){
            layer.alert("文章内容不能为空",{
                title: '提示框',
                icon:2,
            });
            return false;
        }

        if(ar_category_id=="0"){
            layer.alert("请选择文章分类",{
                title: '提示框',
                icon:2,
            });
            return false;
        }

        if(checkedNum == "0"){
            layer.alert("请至少选择一个标签",{
                title: '提示框',
                icon:2,
            });
            return false;
        }else{
            var arr = new Array();
            $("input[type=checkbox]:checked").each(function(){
                arr.push($(this).val());
            });
        }


        $('#submit').attr('disabled',true);
        $('#submit').val('添加中');
        $.ajax({
            type : 'post',
            url : "__CONTROLLER__/add",
            data : {
                'ar_title' : ar_title,
                'ar_author' : ar_author,
                'ar_content' : ar_content,
                'ar_category_id' : ar_category_id,
                'ar_show_status' : $("input[name=ar_show_status]:checked").val(),
                'article_tag_id_list' : arr,
            },
            success : function (response){
                if(response.status){
                    $('#submit').val('添加');
                    layer.msg(response.result,{icon:1,time:1000},function (){
                        location.href="__CONTROLLER__/lst";
                        $('#submit').attr('disabled',false);
                    });
                }else{

                    layer.alert(response.result,{
                        title: '提示框',
                        icon:2,
                    });
                    $('#submit').attr('disabled',false);
                    $('#submit').val('添加');
                }
            }

        });


    });
</script>



<script>
    /************添加新标签**********/
    $("input[name=tag_name]").bind('change',function(){
        $('#tag').css('background',$('#mycolor').val());
        $('#tag').html($(this).val());
    });
    $('#submit1').click(function(){

        var tag_name = $('input[name=tag_name]').val();
        if(tag_name.trim() == ""){
            layer.alert("标签名称不能为空",{
                title: '提示框',
                icon:2,
            });
            return false;
        }

        $('#submit1').attr('disabled',true);
        $('#submit1').val('添加中');
        $.ajax({
            type : 'post',
            url : "{:U('Tag/add')}",
            data : {
                'tag_name' : $('input[name=tag_name]').val(),
                'tag_background_color' : $('input[name=tag_background_color]').val(),
                'article' : '1',
            },
            success : function (response){

                if(response.status){
                    var id = response.new[0]['id'];
                    var tag_name = response.new[0]['tag_name'];
                    var bg = response.new[0]['tag_background_color'];
                    layer.msg(response.result,{icon:1,time:1000},function (){
                        $('#submit1').val('添加');
                        $('#tag_list').append("<li style='display:inline;line-height:30px;'><label class='middle'><input type='checkbox' name='article_tag_id_list[]' value='"+id+"' class='ace'><span class='lbl'><span class='label' style='border-radius:.25em;background:"+bg+"' >"+tag_name+"</span></span></label></li>");

                        $('#tag').html("");
                        $('#form2')[0].reset();
                        $('#submit1').attr('disabled',false);
                    });
                }else{

                    layer.alert(response.result,{
                        title: '提示框',
                        icon:2,
                    });
                    $('#submit1').attr('disabled',false);
                    $('#submit1').val('添加');
                }
            }

        });


    });
</script>









<script type="text/javascript">
//初始化宽度、高度

 $(".left_Competence_add,.Competence_add_style").height($(window).height()).val();; 
 $(".Assign_style").width($(window).width()-500).height($(window).height()).val();
 $(".Select_Competence").width($(window).width()-500).height($(window).height()-40).val();
  //当文档窗口发生改变时 触发  
    $(window).resize(function(){
	
	$(".Assign_style").width($(window).width()-500).height($(window).height()).val();
	$(".Select_Competence").width($(window).width()-500).height($(window).height()-40).val();
	$(".left_Competence_add,.Competence_add_style").height($(window).height()).val();;
	});

</script>
